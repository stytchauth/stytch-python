# !!!
# WARNING: This file is autogenerated
# Only modify code within MANUAL() sections
# or your changes may be overwritten later!
# !!!

from __future__ import annotations

import datetime
import enum
from typing import Any, Dict, List, Optional

import pydantic

from stytch.b2b.models.mfa import MfaRequired
from stytch.b2b.models.organizations import Member, Organization
from stytch.consumer.models.device_history import DeviceInfo
from stytch.consumer.models.sessions import JWK, AuthenticationFactor
from stytch.core.response_base import ResponseBase
from stytch.shared.method_options import Authorization


class ExchangeRequestLocale(str, enum.Enum):
    EN = "en"
    ES = "es"
    PTBR = "pt-br"
    FR = "fr"
    IT = "it"
    DEDE = "de-DE"
    ZHHANS = "zh-Hans"
    CAES = "ca-ES"


class AuthorizationCheck(pydantic.BaseModel):
    """
    Fields:
      - organization_id: Globally unique UUID that identifies a specific Organization. When making API calls, you may also use the organization_slug or organization_external_id as a convenience.
      - resource_id: The identifier of a specific resource within an RBAC authorization check.
      - action: The action that should be returned by a fingerprint lookup for that identifier with a `RULE_MATCH` reason. The following values are valid: `ALLOW` (This is a known valid device grouping or device profile that is part of the default ALLOW listed set of known devices by Stytch), `BLOCK` (This is a known bad or malicious device profile that is undesirable and should be blocked from completing the privileged action), `CHALLENGE` (This is an unknown or potentially malicious device that should be put through increased friction such as 2FA or other forms of extended user verification before allowing the privileged action), or `NONE`. For country codes, `ALLOW` actions are not allowed. If a `NONE` action is specified, it will clear the stored rule.
    """  # noqa

    organization_id: str
    resource_id: str
    action: str


class AuthorizationVerdict(pydantic.BaseModel):
    """
    Fields:
      - authorized: Whether the actor was authorized to perform the specified action on the specified Resource. Always true if the request succeeds.
      - granting_roles: The complete list of Roles that gave the Member permission to perform the specified action on the specified Resource.
    """  # noqa

    authorized: bool
    granting_roles: List[str]


class MemberSession(pydantic.BaseModel):
    """
    Fields:
      - member_session_id: Globally unique UUID that identifies a specific Session in the Stytch API.
      - member_id: Globally unique UUID that identifies a specific Member. When making API calls, you may use an `external_id` in place of the `member_id` if one is set for the member.
      - started_at: The timestamp when the session or process was initiated.
      - last_accessed_at: The timestamp when the session was last accessed or refreshed.
      - expires_at: The timestamp indicating when the session, token, lock, or other resource will expire.
      - authentication_factors: A list of authentication factors used during the session, including type, timestamp, and delivery method.
      - organization_id: Globally unique UUID that identifies a specific Organization. When making API calls, you may also use the organization_slug or organization_external_id as a convenience.
      - roles: Explicit or implicit Roles assigned to this Member.
      - organization_slug: The unique URL slug of the Organization. The slug only accepts alphanumeric characters and the following reserved characters: `-` `.` `_` `~`. Must be between 2 and 128 characters in length. Wherever an organization_id is expected in a path or request parameter, you may also use the organization_slug as a convenience.
    When setting this field, if a session header is passed into the request, the Member Session must have permission to perform the `update.info.slug` action on the `stytch.organization` Resource.
      - custom_claims: A JSON object containing custom claims to include in tokens or sessions.
    """  # noqa

    member_session_id: str
    member_id: str
    started_at: datetime.datetime
    last_accessed_at: datetime.datetime
    expires_at: datetime.datetime
    authentication_factors: List[AuthenticationFactor]
    organization_id: str
    roles: List[str]
    organization_slug: str
    custom_claims: Optional[Dict[str, Any]] = None


class PrimaryRequired(pydantic.BaseModel):
    """
    Fields:
      - allowed_auth_methods: An array of allowed authentication methods. This list is enforced when `auth_methods` is set to `RESTRICTED`.
    The list's accepted values are: `sso`, `magic_link`, `email_otp`, `password`, `google_oauth`, `microsoft_oauth`, `slack_oauth`, `github_oauth`, and `hubspot_oauth`.
    When setting this field, if a session header is passed into the request, the Member Session must have permission to perform the `update.settings.allowed-auth-methods` action on the `stytch.organization` Resource.
    """  # noqa

    allowed_auth_methods: List[str]


class RevokeRequestOptions(pydantic.BaseModel):
    """
    Fields:
      - authorization: Optional authorization object.
    Pass in an active Stytch Member session token or session JWT and the request
    will be run using that member's permissions.
    """  # noqa

    authorization: Optional[Authorization] = None

    def add_headers(self, headers: Dict[str, str]) -> Dict[str, str]:
        if self.authorization is not None:
            headers = self.authorization.add_headers(headers)
        return headers


class AttestResponse(ResponseBase):
    """Response type for `Sessions.attest`.
    Fields:
      - member_id: Globally unique UUID that identifies a specific Member. When making API calls, you may use an `external_id` in place of the `member_id` if one is set for the member.
      - member_session: The MemberSession object containing details about an active authenticated session, including timing information, authentication factors used, and associated roles.
      - session_token: The `session_token` associated with a Member's existing Session.
      - session_jwt: The JSON Web Token (JWT) associated with a Member's existing Session.
      - member: The Member object representing a user within a B2B organization, containing their profile information, authentication methods, roles, and registration details.
      - organization: The Organization object containing details about the B2B organization, including settings for SSO, authentication methods, MFA policies, and member management.
      - member_device: Information about the device used by the member for authentication, including device type, fingerprints, and location data.
    """  # noqa

    member_id: str
    member_session: MemberSession
    session_token: str
    session_jwt: str
    member: Member
    organization: Organization
    member_device: Optional[DeviceInfo] = None


class AuthenticateResponse(ResponseBase):
    """Response type for `Sessions.authenticate`.
    Fields:
      - member_session: The MemberSession object containing details about an active authenticated session, including timing information, authentication factors used, and associated roles.
      - session_token: The `session_token` associated with a Member's existing Session.
      - session_jwt: The JSON Web Token (JWT) associated with a Member's existing Session.
      - member: The Member object representing a user within a B2B organization, containing their profile information, authentication methods, roles, and registration details.
      - organization: The Organization object containing details about the B2B organization, including settings for SSO, authentication methods, MFA policies, and member management.
      - verdict: The result of an authorization check, indicating whether the member is authorized to perform the requested action.
    """  # noqa

    member_session: MemberSession
    session_token: str
    session_jwt: str
    member: Member
    organization: Organization
    verdict: Optional[AuthorizationVerdict] = None


class ExchangeAccessTokenResponse(ResponseBase):
    """Response type for `Sessions.exchange_access_token`.
    Fields:
      - member_id: Globally unique UUID that identifies a specific Member. When making API calls, you may use an `external_id` in place of the `member_id` if one is set for the member.
      - session_token: The `session_token` associated with a Member's existing Session.
      - session_jwt: The JSON Web Token (JWT) associated with a Member's existing Session.
      - member: The Member object representing a user within a B2B organization, containing their profile information, authentication methods, roles, and registration details.
      - organization: The Organization object containing details about the B2B organization, including settings for SSO, authentication methods, MFA policies, and member management.
      - member_session: The MemberSession object containing details about an active authenticated session, including timing information, authentication factors used, and associated roles.
      - member_device: Information about the device used by the member for authentication, including device type, fingerprints, and location data.
    """  # noqa

    member_id: str
    session_token: str
    session_jwt: str
    member: Member
    organization: Organization
    member_session: Optional[MemberSession] = None
    member_device: Optional[DeviceInfo] = None


class ExchangeResponse(ResponseBase):
    """Response type for `Sessions.exchange`.
    Fields:
      - member_id: Globally unique UUID that identifies a specific Member. When making API calls, you may use an `external_id` in place of the `member_id` if one is set for the member.
      - session_token: The `session_token` associated with a Member's existing Session.
      - session_jwt: The JSON Web Token (JWT) associated with a Member's existing Session.
      - member: The Member object representing a user within a B2B organization, containing their profile information, authentication methods, roles, and registration details.
      - organization: The Organization object containing details about the B2B organization, including settings for SSO, authentication methods, MFA policies, and member management.
      - member_authenticated: A boolean indicating whether the member has been fully authenticated (true) or if additional steps like MFA are still required (false).
      - intermediate_session_token: The Intermediate Session Token. This token does not necessarily belong to a specific instance of a Member, but represents a bag of factors that may be converted to a member session. The token can be used with the [OTP SMS Authenticate endpoint](https://stytch.com/docs/b2b/api/authenticate-otp-sms), [TOTP Authenticate endpoint](https://stytch.com/docs/b2b/api/authenticate-totp), or [Recovery Codes Recover endpoint](https://stytch.com/docs/b2b/api/recovery-codes-recover) to complete an MFA flow and log in to the Organization. The token has a default expiry of 10 minutes. It can also be used with the [Exchange Intermediate Session endpoint](https://stytch.com/docs/b2b/api/exchange-intermediate-session) to join a specific Organization that allows the factors represented by the intermediate session token; or the [Create Organization via Discovery endpoint](https://stytch.com/docs/b2b/api/create-organization-via-discovery) to create a new Organization and Member. Intermediate Session Tokens have a default expiry of 10 minutes.
      - member_session: The MemberSession object containing details about an active authenticated session, including timing information, authentication factors used, and associated roles.
      - mfa_required: An object indicating whether multi-factor authentication is required, and which MFA methods are available to complete the authentication flow.
      - primary_required: An object indicating that a primary authentication factor is required, containing the list of allowed authentication methods.
      - member_device: Information about the device used by the member for authentication, including device type, fingerprints, and location data.
    """  # noqa

    member_id: str
    session_token: str
    session_jwt: str
    member: Member
    organization: Organization
    member_authenticated: bool
    intermediate_session_token: str
    member_session: Optional[MemberSession] = None
    mfa_required: Optional[MfaRequired] = None
    primary_required: Optional[PrimaryRequired] = None
    member_device: Optional[DeviceInfo] = None


class GetJWKSResponse(ResponseBase):
    """Response type for `Sessions.get_jwks`.
    Fields:
      - keys: Cryptographic keys used for signing, encryption, or verification.
    """  # noqa

    keys: List[JWK]


class GetResponse(ResponseBase):
    """Response type for `Sessions.get`.
    Fields:
      - member_sessions: A list of active sessions for the member.
    """  # noqa

    member_sessions: List[MemberSession]


class MigrateResponse(ResponseBase):
    """Response type for `Sessions.migrate`.
    Fields:
      - member_id: Globally unique UUID that identifies a specific Member. When making API calls, you may use an `external_id` in place of the `member_id` if one is set for the member.
      - session_token: The `session_token` associated with a Member's existing Session.
      - session_jwt: The JSON Web Token (JWT) associated with a Member's existing Session.
      - member: The Member object representing a user within a B2B organization, containing their profile information, authentication methods, roles, and registration details.
      - organization: The Organization object containing details about the B2B organization, including settings for SSO, authentication methods, MFA policies, and member management.
      - member_session: The MemberSession object containing details about an active authenticated session, including timing information, authentication factors used, and associated roles.
    """  # noqa

    member_id: str
    session_token: str
    session_jwt: str
    member: Member
    organization: Organization
    member_session: Optional[MemberSession] = None


class RevokeResponse(ResponseBase):
    """Response type for `Sessions.revoke`.
    Fields:
    """  # noqa


# MANUAL(LocalJWTResponse)(Types)
class LocalJWTResponse(pydantic.BaseModel):
    member_session: MemberSession
    roles_claim: Optional[List[str]]


# ENDMANUAL(LocalJWTResponse)


# MANUAL(AuthenticateJWTLocalResponse)(Types)
class AuthenticateJWTLocalResponse(ResponseBase):
    member_session: MemberSession
    session_jwt: str


# ENDMANUAL(AuthenticateJWTLocalResponse)
